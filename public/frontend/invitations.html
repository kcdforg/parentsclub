<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Invitations - Registration Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Hide feature-dependent elements by default to prevent flash */
        [data-feature] {
            display: none !important;
        }
        
        /* Show enabled features when body has feature-loaded class */
        .feature-loaded [data-feature][data-feature-enabled="true"] {
            display: block !important;
        }
        
        /* For inline elements, use inline display */
        .feature-loaded [data-feature][data-feature-enabled="true"].inline {
            display: inline !important;
        }
        
        /* For flex elements, use flex display */
        .feature-loaded [data-feature][data-feature-enabled="true"].flex {
            display: flex !important;
        }
        
        /* Keep disabled features hidden */
        .feature-loaded [data-feature][data-feature-enabled="false"] {
            display: none !important;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#06b6d4'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation will be injected here -->
    <div id="navigationContainer"></div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Shared Invitation Component Container -->
        <div id="invitationContainer">
            <!-- Shared invitation component will be rendered here -->
        </div>
    </div>



    <script type="module">
        import { initializeFeatureControls } from './js/feature-utils.js';
        import { createPublicNavigation } from './js/components/PublicNavigation.js';
        import { publicModals } from './js/components/PublicModals.js';
        import { InvitationComponent } from '../../shared/frontend/components/InvitationComponent.js';
        
        async function initializePage() {
            try {
                // Initialize PublicModals for toast notifications
                publicModals.renderAllModals();
                
                // Ensure publicModals is globally accessible for shared component
                window.publicModals = publicModals;
                
                // Determine user type from localStorage or API call
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                const userType = userData.approval_status === 'approved' ? 'approved' : 'public';
                
                // Create navigation first
                createPublicNavigation('invitations', userType, 'navigationContainer');
                
                // Initialize feature controls
                await initializeFeatureControls();
                
                // Initialize shared invitation component
                window.invitationComponent = new InvitationComponent({
                    container: '#invitationContainer',
                    apiBaseUrl: '/regapp2/shared/backend'
                });
                
                console.log('Invitations page initialized successfully');
            } catch (error) {
                console.error('Error initializing invitations page:', error);
                // Create navigation anyway to avoid blank page
                createPublicNavigation('invitations', 'public', 'navigationContainer');
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }
    </script>
</body>
</html>
